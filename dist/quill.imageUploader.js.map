{"version":3,"file":"quill.imageUploader.js","sources":["../src/blots/image.js","../src/quill.imageUploader.js"],"sourcesContent":["import Quill from \"quill\";\n\nconst InlineBlot = Quill.import(\"blots/block\");\n\nexport class LoadingImage extends InlineBlot {\n  static create(src) {\n    const node = super.create(src);\n    if (src === true) return node;\n\n    const image = document.createElement(\"img\");\n    image.setAttribute(\"src\", src);\n    node.appendChild(image);\n\n    return node;\n  }\n  deleteAt(index, length) {\n    super.deleteAt(index, 2);\n    this.cache = {};\n  }\n  static value(domNode) {\n    const { src, custom } = domNode.dataset;\n    return { src, custom };\n  }\n}\n\nLoadingImage.blotName = \"imageBlot\";\nLoadingImage.className = \"image-uploading\";\nLoadingImage.tagName = \"span\";\nQuill.register({ \"formats/imageBlot\": LoadingImage });\n","import \"./blots/image\";\n\nimport \"./quill.imageUploader.css\";\n\nclass ImageUploader {\n  constructor(quill, options) {\n    this.quill = quill;\n    this.options = options;\n    this.range = null;\n\n    if (typeof this.options.upload !== \"function\")\n      console.warn(\n        \"[Missing config] upload function that returns a promise is required\"\n      );\n\n    var toolbar = this.quill.getModule(\"toolbar\");\n    toolbar.addHandler(\"image\", this.selectLocalImage.bind(this));\n  }\n\n  selectLocalImage() {\n    this.range = this.quill.getSelection();\n    this.fileHolder = document.createElement(\"input\");\n    this.fileHolder.setAttribute(\"type\", \"file\");\n    this.fileHolder.setAttribute(\"accept\", \"image/*\");\n    this.fileHolder.setAttribute(\"style\", \"visibility:hidden\");\n\n    this.fileHolder.onchange = this.fileChanged.bind(this);\n\n    document.body.appendChild(this.fileHolder);\n\n    this.fileHolder.click();\n\n    window.requestAnimationFrame(() => {\n      document.body.removeChild(this.fileHolder);\n    });\n  }\n\n  fileChanged() {\n    const file = this.fileHolder.files[0];\n\n    const fileReader = new FileReader();\n\n    fileReader.addEventListener(\n      \"load\",\n      () => {\n        let base64ImageSrc = fileReader.result;\n        this.insertBase64Image(base64ImageSrc);\n      },\n      false\n    );\n\n    if (file) {\n      fileReader.readAsDataURL(file);\n    }\n\n    this.options.upload(file).then(\n      imageUrl => {\n        this.insertToEditor(imageUrl);\n      },\n      error => {\n        console.warn(error.message);\n      }\n    );\n  }\n\n  insertBase64Image(url) {\n    const range = this.range;\n    this.quill.insertEmbed(range.index, \"image\", `${url}`);\n  }\n\n  insertToEditor(url) {\n    const range = this.range;\n    // Delete the placeholder image\n    this.quill.deleteText(range.index, 2);\n    // Insert the server saved image\n    this.quill.insertEmbed(range.index, \"image\", `${url}`);\n\n    range.index++;\n    this.quill.setSelection(range, \"api\");\n  }\n}\n\nexport default ImageUploader;\n"],"names":["LoadingImage","create","src","node","super","image","document","createElement","setAttribute","appendChild","deleteAt","index","length","cache","value","domNode","dataset","Quill","import","blotName","className","tagName","register","ImageUploader","constructor","quill","options","range","this","upload","console","warn","getModule","addHandler","selectLocalImage","bind","getSelection","fileHolder","onchange","fileChanged","body","click","window","requestAnimationFrame","removeChild","file","files","fileReader","FileReader","addEventListener","insertBase64Image","result","readAsDataURL","then","imageUrl","insertToEditor","error","message","url","insertEmbed","deleteText","setSelection"],"mappings":"4EAIaA,yIACJC,gBAAOC,OACNC,EAAOC,EAAMH,iBAAOC,OACd,IAARA,EAAc,OAAOC,MAEnBE,EAAQC,SAASC,cAAc,cACrCF,EAAMG,aAAa,MAAON,GAC1BC,EAAKM,YAAYJ,GAEVF,eAETO,kBAASC,EAAOC,eACRF,mBAASC,EAAO,QACjBE,MAAQ,MAERC,eAAMC,SACaA,EAAQC,cACzB,gCAnBQC,EAAMC,OAAO,gBAuBhClB,EAAamB,SAAW,YACxBnB,EAAaoB,UAAY,kBACzBpB,EAAaqB,QAAU,OACvBJ,EAAMK,SAAS,qBAAuBtB,QCxBhCuB,EACJC,SAAYC,EAAOC,QACZD,MAAQA,OACRC,QAAUA,OACVC,MAAQ,KAEsB,mBAAxBC,KAAKF,QAAQG,QACtBC,QAAQC,KACN,uEAGUH,KAAKH,MAAMO,UAAU,WAC3BC,WAAW,QAASL,KAAKM,iBAAiBC,KAAKP,QAGzDM,YAAAA,4CACOP,MAAQC,KAAKH,MAAMW,oBACnBC,WAAa/B,SAASC,cAAc,cACpC8B,WAAW7B,aAAa,OAAQ,aAChC6B,WAAW7B,aAAa,SAAU,gBAClC6B,WAAW7B,aAAa,QAAS,0BAEjC6B,WAAWC,SAAWV,KAAKW,YAAYJ,KAAKP,eAExCY,KAAK/B,YAAYmB,KAAKS,iBAE1BA,WAAWI,QAEhBC,OAAOC,0CACIH,KAAKI,YAAYhB,EAAKS,eAInCE,YAAAA,kCACQM,EAAOjB,KAAKS,WAAWS,MAAM,GAE7BC,EAAa,IAAIC,WAEvBD,EAAWE,iBACT,oBAGOC,kBADgBH,EAAWI,UAGlC,GAGEN,GACFE,EAAWK,cAAcP,QAGtBnB,QAAQG,OAAOgB,GAAMQ,cACxBC,KACOC,eAAeD,aAEtBE,WACUzB,KAAKyB,EAAMC,YAKzBP,YAAAA,2BAAkBQ,QAEXjC,MAAMkC,YADG/B,KAAKD,MACUhB,MAAO,WAAY+C,IAGlDH,YAAAA,wBAAeG,OACP/B,EAAQC,KAAKD,WAEdF,MAAMmC,WAAWjC,EAAMhB,MAAO,QAE9Bc,MAAMkC,YAAYhC,EAAMhB,MAAO,WAAY+C,GAEhD/B,EAAMhB,aACDc,MAAMoC,aAAalC,EAAO"}